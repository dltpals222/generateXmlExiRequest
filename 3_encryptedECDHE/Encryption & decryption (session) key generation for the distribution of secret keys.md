ISO 15118  communication uses  an  ephemeral-static  Diffie-Hellman  key  exchange  protocol  to  derive  a  session  key  where  the  receiver's  keys  are  static.  The  SA  (eMSP)  uses  this  session  key  to  transmit  the  private key in encrypted form to the EVCC.

In the ephemeral-static variant of the Diffie-Hellman protocol, the public key of the receiver (EVCC) does not change, i.e. is static, and is already known to the sender (eMSP). The sender, however, still uses an ephemeral public key that is transmitted to the receiver. In this manner, both sender and receiver can derive the same session key without a reply message from the receiver.

Since  the  SA  uses  ephemeral  keys,  the  derived  session  keys  will  be  different  for  each  instance  (distribution) of the secret keys (private key).

#### NOTE 1 The ephemeral-static Diffie-Hellman protocol does not provide perfect forward secrecy, i.e. if the static private key of the EVCC (OEM provisioning certificate) is leaked to an adversary, then this adversary can derive the respective session key(s) and decrypt any past and future communication between the eMSP and EVCC that relies on  the  private  key  of  OEM  provisioning certificate  (or  a  key  derived  from  the  private  key  of  OEM  provisioning certificate) for secrecy. The same is true for the ephemeral private key of the eMSP (in case eMSP reuses this key, all transfers will be affected). In addition, the EVCC leaking the OEM provisioning private key allows   an adversary to impersonate this EVCC and generate signatures as if the adversary is/was the EVCC, as the basic key used for signatures is the same as the basic key used for encryption, i.e. the private key of the OEM provisioning certificate.

### [V2G20-2710]If  SA  uses  the  elliptic  curve  corresponding  to  signature  algorithm  specified  by  [V2G20-2319],  the  SA  (eMSP)  shall  additionally  support  X448  as  specified  byIETF RFC 7748 for calculation  of  the  ECDHE  secret  and  key-derivation  for  the  encryption of private keys.   

### [V2G20-2711]If  EVCC  uses  the  elliptic  curve  corresponding  to  signature  algorithm  specified  by  [V2G20-2319],    the    EVCC    shall    additionally    support    X448    as    specified    by IETF RFC 7748 for calculation  of  the  ECDHE  secret  and  key-derivation  for  the  decryption of encrypted information like private keys.

### [V2G20-2524]The SA (eMSP) shall support calculation of the ECDHE secret and the key derivation function,  as  specified  by  NIST Special Publication 800-56A,  for  the  encryption  of private keys.

### [V2G20-2525]The  EVCC  shall  support  calculation  of  the  ECDHE  secret  and  the  key  derivation  function,  as  specified  by  NIST Special Publication 800-56A,  for  the  decryption  of  encrypted information like private keys.

### [V2G20-2526]When the mechanism defined by [V2G20-2320] indicates usage of the (elliptic curve) EC as specified by [V2G20-2674], the SA (eMSP) shall generate a 521 bit ephemeral public/private key pair using elliptic curve secp521r1[SECG notation] as specified by NIST Special Publication 800-56A. 

### [V2G20-2527]When   the   mechanism   defined   by   [V2G20-2320]   indicates   usage   of   the   curve corresponding to the signature algorithm specified by [V2G20-2319], the SA (eMSP) shall generate a 448 bit ephemeral public/private key pair using ECC algorithm X448 as specified by IETF RFC 7748.

### [V2G20-2528]The private key generated by [V2G20-2526] or [V2G20-2527] shall be used by the SA (eMSP)  as  ephemeral  private  key  for  calculation  of  the  session  key  as  defined  by  [V2G20-2535]. 

#### NOTE 2     It is assumed that the ephemeral private key is destroyed by the SA after the session key was derived.

### [V2G20-2529]When the mechanism defined by [V2G20-2320] indicates usage of the (elliptic curve) EC as specified by [V2G20-2674], the "Subject Public Key" of the OEM provisioning certificate  shall  be  used  as  static  public  key  for  calculation  of  the  session  key  as  defined by [V2G20-2535]. 

#### NOTE 3 Refer to the "subjectPublicKey" extension in B.7.1.

#### NOTE 4     If [V2G20-2595]  applies, the  TPM  storage  key  from  the  respective  OEM  provisioning  certificate  extension is used by the SA as the public static key according to [V2G20-2518]. 

### [V2G20-2530]When the mechanism defined by [V2G20-2320] indicates usage of the (elliptic curve) EC  as  specified  by  [V2G20-2319],  the  "Alternate  Subject  Public  Key"  of  the  OEM  provisioning certificate shall be used as static public key for calculation of the session key as defined by [V2G20-2535]. 

#### NOTE 5 Refer to the "subjectAltPublicKey" extension in B.7.2.

#### NOTE 6     If [V2G20-2595]  applies, the  TPM  storage  key  from  the  respective  OEM  provisioning  certificate  extension  is used by the SA as the public static key according to [V2G20-2518]. 

### [V2G20-2531]When the EVCC receives the parameter ECDHCurve set to "SECP521", it shall use the 1056  least  significant  bits  of  the  DHPublicKey  as  the  public  key  in  calculation  of  the  session key as defined by [V2G20-2535]. 

### [V2G20-2532]When the EVCC receives the parameter ECDHCurve set to "X448", it shall use the 448 least significant bits of the DHPublicKey as the public key in calculation of the session key as defined by [V2G20-2535]. 

### [V2G20-2533]If    the EVCC receives the parameter ECDHCurve set to "SECP521", it shall use the OEM provisioning certificate private key along with the public key calculated from [V2G20-2531] for calculation of the session key as defined by [V2G20-2535].

#### NOTE 7 Refer  to  B.7.1 for  the  OEM  provisioning certificate  profile  associated  with  the  algorithm  specified  by  [V2G20-2674]. 

#### NOTE 8     If EVCC is equipped with TPM 2.0, the EVCC will perform the direct TPM import and apply requirement [V2G20-2523] instead.

### [V2G20-2534]If the EVCC receives the parameter ECDHCurve set to "X448", it shall use the private key  associated  with  the  "Alternate  Subject  Public  Key"  of  the  OEM  provisioning certificate along with the public key calculated from [V2G20-2532] for calculation of the session key as defined by [V2G20-2535].

#### NOTE 9 Refer  to  B.7.2 for  the  OEM  provisioning certificate  profile  associated  with  the  algorithm  specified  by  [V2G20-2319] and [V2G20-2674].  

#### NOTE 10    If EVCC is equipped with TPM 2.0, the EVCC will perform the direct TPM import and apply requirement [V2G20-2523] instead.

### [V2G20-2535]For session key agreement, the ephemeral-static ECDHE protocol "6.2.2.2 One-Pass Diffie-Hellman,  C(1,  1,  ECC  CDH)"  as  defined  in  NIST Special Publication 800-56Ashall be used. The KDF shall be the "concatenation  key  derivation  function", where the hash function shall be SHA512. In case the curve corresponding to ECC signature algorithm  specified  by  [V2G20-2319]  is  chosen,  the  input  parameters  for  KDF  including the shared secret shall be derived according to IETF RFC 7748. The SA shall act as party U (as defined in said NIST document) and the EVCC shall act as party V. The protocol shall use elliptic curves as defined in Annex B. The algorithm ID shall be one  character  0x01.  The  sender  name  ID  U  shall  be  one  character  "U"  =  0x55,  thereceiver name ID V shall be one character "V" = 0x56. A symmetric encryption key of exactly 256 bits shall be derived.

#### NOTE 11 The authenticity of the transmission is ensured by the surrounding signature. The authenticity check is vital for the security of the ECDHE protocol.

#### NOTE 12    For a more detailed explanation please refer to Figure 27. 

### [V2G20-822]A certificate whose key pair is used for ECDHE shall have its keyAgreement flag set. This  applies  to  all  OEM  provisioning certificates  and  shall  be  enforced  by  all  participating parties.